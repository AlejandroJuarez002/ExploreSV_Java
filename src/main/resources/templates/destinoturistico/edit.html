<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="/layouts/_mainLayout" xmlns="http://www.w3.org/1999/html">

<div layout:fragment="content">
    <h1>Editar destino</h1>
    <form th:action="@{/destinoTuristicos/save}" th:object="${destinoTuristico}" method="post" enctype="multipart/form-data">
        <input type="hidden" th:field="*{Id}">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="nombre">Nombre</label>
                    <input type="text" class="form-control" th:field="*{nombre}" Id="nombre" placeholder="Nombre del destino" required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="descripcion">Descripcion</label>
                    <textarea class="form-control" th:field="*{descripcion}" id="descripcion" cols="12" rows="3" required></textarea>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="ubicacion">Ubicacion</label>
                    <textarea class="form-control" th:field="*{ubicacion}" id="ubicacion" cols="12" rows="3" required></textarea>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="horario">Horario</label>
                    <textarea class="form-control" th:field="*{horario}" id="horario" cols="12" rows="3" required></textarea>
                </div>
            </div>
        </div>
        <div class="form-group mt-3">
            <label>Im치genes actuales</label>
            <div class="d-flex flex-wrap">
                <div th:each="img : ${destinoTuristico.imagenes}" class="p-1">
                    <img th:if="${img.base64Image != null}"
                         th:src="'data:image/png;base64,' + ${img.base64Image}"
                         alt="Imagen destino"
                         style="width:100px;height:100px;object-fit:cover;border-radius:5px;">
                </div>
            </div>
        </div>

        <!-- Subir nuevas im치genes -->
        <div class="form-group mt-3">
            <label for="imagenFiles">nuevas im치genes</label>
            <input type="file" id="imagenFiles" name="imagenFiles" accept="image/*" multiple class="form-control">
        </div>

        <div id="preview" style="margin-top:10px;"></div>
        <hr>
        <button type="submit" class="btn btn-primary">Guardar cambios</button>
        <a th:href="@{/destinoTuristicos}">Regresar</a>
    </form>

    <script>
        // Mostrar vista previa de las im치genes nuevas
        document.getElementById("imagenFiles").addEventListener("change", function (event) {
            let preview = document.getElementById("preview");
            preview.innerHTML = ""; // limpia previews anteriores

            Array.from(event.target.files).forEach(file => {
                if (file.type.startsWith("image/")) {
                    let reader = new FileReader();
                    reader.onload = function (e) {
                        let img = document.createElement("img");
                        img.src = e.target.result;
                        img.width = 120;
                        img.style.margin = "5px";
                        img.style.border = "1px solid #ccc";
                        preview.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                }
            });
        });
    </script>

</div>

